"use strict";angular.module("VisaCreatorApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngStorage"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/top.html",controller:"TopCtrl"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/japan-visa-form-step1",{templateUrl:"views/japan-visa-form-step1.html",controller:"japanVisaFormCtrlStep1"}).when("/japan-visa-form-step2",{templateUrl:"views/japan-visa-form-step2.html",controller:"japanVisaFormCtrlStep2"}).when("/japan-visa-form-step3",{templateUrl:"views/japan-visa-form-step3.html",controller:"japanVisaFormCtrlStep3"}).otherwise({redirectTo:"/"})}]),angular.module("VisaCreatorApp").controller("japanVisaFormCtrlStep1",["$rootScope","$scope","japanVisaService","$location","$sessionStorage",function(a,b,c,d,e){b.user={};for(var f in e.user)b.user.key=e.user.key;b.$on("storeFields",function(){console.log("step1");for(var a in b.user)"undefined"==typeof e.user.key&&(e.user.key={}),e.user.key=b.user.key}),b.toStep2=function(a){c.saveStep1(a),d.path("/japan-visa-form-step2")}}]).controller("japanVisaFormCtrlStep2",["$scope","japanVisaService","$location","$sessionStorage",function(a,b,c,d){a.user={};for(var e in d.user)a.user.key=d.user.key;a.$on("storeFields",function(){console.log("step2");for(var b in a.user)"undefined"==typeof d.user.key&&(d.user.key={}),d.user.key=a.user.key}),a.toStep3=function(a){b.saveStep2(a),c.path("/japan-visa-form-step3")}}]).controller("japanVisaFormCtrlStep3",["$scope","japanVisaService","$location","$sessionStorage",function(a,b,c,d){a.user={},console.log(d.user);for(var e in d.user)a.user.key=d.user.key;a.$on("storeFields",function(){console.log("step3"),console.log(a.user);for(var b in a.user)console.log(b),"undefined"==typeof d.user.key&&(d.user.key={}),d.user.key=a.user.key;console.log(d.user)}),a.downloadJapanVisaForm=function(a){var d=b.saveStep3(a);d.then(function(a){console.log(a.url);var b=document.createElement("a");b.href=a.url,b.click(),c.path("/")}).catch(function(){console.log("error to submit form")})}}]).controller("LoginCtrl",["$scope","$location","Login","$sessionStorage","$rootScope",function(a,b,c,d,e){c.getStatus(),a.fb_login=function(){e.$broadcast("storeFields"),console.log(d.user),alert("a"),c.fbLogin(b.url())}}]).controller("TopCtrl",["$scope",function(){}]).controller("MainCtrl",["$scope","japanVisaService",function(a){a.id=1,a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("VisaCreatorApp").factory("japanVisaService",["$resource","$location","$sessionStorage",function(a,b,c){var d={},e={},f=function(){return a("/api/japan/form").save(d).$promise};return{saveStep1:function(a){for(var b in a)"gender"===b?"male"===a[b]?d.genderMale="X":"female"===a[b]&&(d.genderFemale="X"):"martialStatus"===b?"single"===a[b]?d.martialStatusSingle="X":"married"===a[b]?d.martialStatusMarried="X":"widowed"===a[b]?d.martialStatusWidowed="X":"divorced"===a[b]&&(d.martialStatusDivorced="X"):"passportType"===b?"diplomatic"===a[b]?d.passportTypeDiplomatic="X":"official"===a[b]?d.passportTypeOfficial="X":"ordinary"===a[b]?d.passportTypeOrdinary="X":"other"===a[b]&&(d.passportTypeOther="X"):"crime"===b?"yes"===a[b]?d.crimeYes="X":"no"===a[b]&&(d.crimeNo="X"):"sentenced"===b?"yes"===a[b]?d.sentencedYes="X":"no"===a[b]&&(d.sentencedNo="X"):"overstay"===b?"yes"===a[b]?d.overstayYes="X":"no"===a[b]&&(d.overstayNo="X"):"drug"===b?"yes"===a[b]?d.drugYes="X":"no"===a[b]&&(d.drugNo="X"):"prostitution"===b?"yes"===a[b]?d.prostitutionYes="X":"no"===a[b]&&(d.prostitutionNo="X"):"trafficking"===b?"yes"===a[b]?d.traffickingYes="X":"no"===a[b]&&(d.traffickingNo="X"):d[b]=a[b],e.key=a.key;c.user=e},saveStep2:function(a){for(var b in a)d[b]=a[b],e.key=a.key;c.user=e},saveStep3:function(a){for(var b in a)"guarantorGender"===b?"male"===a[b]?d.guarantorGenderMale="X":"female"===a[b]&&(d.guarantorGenderFemale="X"):"inviterGender"===b?"male"===a[b]?d.inviterGenderMale="X":"female"===a[b]&&(d.inviterGenderFemale="X"):d[b]=a[b],e.key=a.key;return c.user=e,f()}}}]),angular.module("VisaCreatorApp").factory("Login",["$http","$rootScope","$location",function(a,b){return{fbLogin:function(b){a.post("/auth/whereami",{location:b}).success(function(){var a=document.createElement("a");a.href="/auth/facebook/authenticate",a.click()}).error(function(){console.log("failed to login")})},getStatus:function(){a({method:"GET",url:"/api/login/status"}).success(function(a){console.log(a),"true"===a.login?(b.loggedIn=!0,b.first_name=a.first_name):(b.loggedIn=!1,b.first_name="")}).error(function(){b.loggedIn=!1,b.first_name=""})}}}]);